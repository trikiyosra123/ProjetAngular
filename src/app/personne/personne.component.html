<div class="container">
  <!-- En-t√™te -->
  <div class="header">
    <div>
      <h1>Gestion des Personnes</h1>
      <p>Total : {{ personnes.length }} personne(s)</p>
    </div>
    <button class="btn-add-modal" (click)="openModal()">
      + Ajouter une Personne
    </button>
  </div>

  <!-- FILTRES REGION & DEPARTEMENT --> 
  <div class="filters">
    <div class="filter-group">
      <label>Filtrer par R√©gion</label>
      <select [(ngModel)]="selectedRegionId" (change)="onRegionChange()">
        <option [value]="null">-- Toutes les r√©gions --</option>
        <option *ngFor="let region of regions" [value]="region.id">{{ region.nom }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Filtrer par D√©partement</label>
      <select [(ngModel)]="selectedDepartementId" (change)="applyFilters()">
        <option [value]="null">-- Tous les d√©partements --</option>
        <option *ngFor="let dept of departements" [value]="dept.id">{{ dept.nom }}</option>
      </select>
    </div>

    <button class="btn-reset" (click)="resetFilters()">R√©initialiser les filtres</button>
          <div class="stats-cards">
            <div class="stat-card">
    <p class="filter-result">{{ filteredPersonnes.length }} personne(s) trouv√©e(s)</p>
  </div>
  </div>
  </div>

  <!-- MODALE -->
  <div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingPersonneId ? 'Modifier la Personne' : 'Ajouter une Nouvelle Personne' }}</h2>
        <button class="close-btn" (click)="closeModal()">√ó</button>
      </div>

      <div class="modal-body">
        <div class="form-grid">
          <div class="form-group">
            <label>Nom <span class="required">*</span></label>
            <input
              type="text"
              [(ngModel)]="newPersonne.nom"
              placeholder="Nom"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label>Pr√©nom <span class="required">*</span></label>
            <input
              type="text"
              [(ngModel)]="newPersonne.prenom"
              placeholder="Pr√©nom"
              class="form-input"
            />
          </div>

          <div class="form-group full-width">
            <label>D√©partement <span class="required">*</span></label>
            <select [(ngModel)]="newPersonne.departementId" class="form-select">
              <option [value]="0" disabled>S√©lectionner un d√©partement</option>
              <option *ngFor="let dep of allDepartements" [value]="dep.id">
                {{ dep.nom }}
              </option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-submit" (click)="addPersonne()">
            {{ editingPersonneId ? 'Modifier' : 'Ajouter' }}
          </button>
          <button class="btn-cancel" (click)="closeModal()">
            Annuler
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Liste des personnes -->
  <div class="personne-list">
    <h2>Liste des Personnes</h2>
    <table>
      <thead>
        <tr>
          <th>Profile</th>
          <th>Nom</th>
          <th>Pr√©nom</th>
          <th>D√©partement</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of filteredPersonnes">
          <td><div class="initials">{{ getInitials(p.nom, p.prenom) }}</div></td>
          <td>{{ p.nom }}</td>
          <td>{{ p.prenom }}</td>
          <td>{{ p.departement?.nom }}</td>
          <td class="actions">
            <button class="btn-edit" (click)="editPersonneInModal(p)">‚úèÔ∏è</button>
            <button class="btn-delete" (click)="deletePersonne(p.id)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Notification -->
  <div *ngIf="notification.show" class="notification" [ngClass]="notification.type">
    {{ notification.message }}
  </div>
</div>